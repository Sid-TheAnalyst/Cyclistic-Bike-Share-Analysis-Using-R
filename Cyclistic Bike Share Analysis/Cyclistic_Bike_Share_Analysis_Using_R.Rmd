---
title: "Google Data Analytics Capstone Project : Cyclistic Bike-Share Analysis Using R"
output:
  pdf_document: default
  html_document: default
---

# __Goal__   
   
Design marketing strategies aimed at converting casual riders into annual members.   

## Casual riders   
Riders who purchased a single ride or full-day Passes.

## Members
Riders who purchased an Annual Membership.


# __Stakeholders__
   
The project stakeholder is __Lily Moreno__,the director of marketing and the manager of Cyclistic, a bike-share company in Chicago. She set the above goal and has a broader vision of the business. The analyst team has to communicate efficiently and frequently with _Lily_ in all steps of the analysis process in order to achieve the goal.   

# __I) Ask__   

Three questions will guide the future marketing program:   

* How do annual members and casual riders use Cyclistic bikes differently?
* Why would casual riders buy Cyclistic annual memberships?
* How can Cyclistic use digital media to influence casual riders to become members?

# __II) Prepare__

The public data is generated by Motivate International Inc under a license, this makes the data source reliable and original. Google Data Analytic provided this data through a link. Collected (downloaded) from [Download the previous 12 months of Cyclistic trip data here.](https://divvy-tripdata.s3.amazonaws.com/index.html)  

* I have limit my analysis to historical data from Jan-2022 to Dec-2022.
* The data downloaded is stored in a CSV files.
* To get a sense of the data, I have open one file using Microsoft Excel and found that,it contains information on each ride's id, customers' type (casual or member), the start and end datetime of each trip, the start and end station names.
* Also found that, there is no private columns available, the entire data can be viewed by the whole team, no need to hide or give some special access to anyone.
* There are some columns with some missing values, in the "process step" I will tackle this issue.

# __III) Process__   

Now for data exploration, data cleaning & data shaping I have use the 'tidyverse' package of R.  
Also I have document all the steps involve in the data processing.

```{r}
#Load the "tidyverse" package
library(tidyverse)
```
# __1) Import the data__   

I have 12 CSV files of the same structure (column names and number of columns), stored in my local drive. 

```{r message=FALSE, warning=FALSE}
# Import each file and save it in the separate data frame.

data_01 <- read.csv("202201-divvy-tripdata.csv")
data_02 <- read.csv("202202-divvy-tripdata.csv")
data_03 <- read.csv("202203-divvy-tripdata.csv")
data_04 <- read.csv("202204-divvy-tripdata.csv")
data_05 <- read.csv("202205-divvy-tripdata.csv")
data_06 <- read.csv("202206-divvy-tripdata.csv")
data_07 <- read.csv("202207-divvy-tripdata.csv")
data_08 <- read.csv("202208-divvy-tripdata.csv")
data_09 <- read.csv("202209-divvy-tripdata.csv")
data_10 <- read.csv("202210-divvy-tripdata.csv")
data_11 <- read.csv("202211-divvy-tripdata.csv")
data_12 <- read.csv("202212-divvy-tripdata.csv")

```

Confirmed the structure of imported data by looking at the 1st row of data frame "data_01" as well as "data_12".

```{r}
head(data_01,1)
```
```{r}
head(data_12,1)
```

* The results of theses queries: data_01 and data_12, give the same number of columns, the same type and the same name.
* Hence, I can confidently concatenate these data frames.

# __2)  Concatenate the data frames__   

```{r}
data_2022 <-  rbind(data_01,data_02,data_03,data_04,data_05,data_06,data_07,data_08,data_09,data_10,data_11,data_12)
```

```{r}
# To get the structure of the concatenated data set.

str(data_2022)
```

* We have a total of 13 columns and 5,667,717 records. 

# __3) Understand the Data type of each column__

* ride_id, start_station_name, start_station_id, end_station_name, end_station_id, member_casual and rideable_type are of type "chr", so a string, which is as expected.
* started_at and ended_at are of type "Chr". I was expecting a datetime type, because the columns are made up of a date and a time.
* start_lat, start_lng, end_lat and end_lng are of type "num", it matches the expectation.

# __4) Change the data type of "started_at" and "ended_at"__


```{r}
# make the copy of the data set
data_2022_v001 <- data_2022

# Added an duplicate columns
data_2022_v001$started_at_dup <- data_2022_v001$started_at
data_2022_v001$ended_at_dup <- data_2022_v001$ended_at

# Change the data types from 'Str' to 'POSIXct'(datetime)
data_2022_v001$started_at_dup <- as.POSIXct(data_2022_v001$started_at_dup)
data_2022_v001$ended_at_dup <- as.POSIXct(data_2022_v001$ended_at_dup)

#validate the structure of data set after data type conversion
str(data_2022_v001)

```

```{r}
# Select the 1st value from started_at
data_2022_v001$started_at_dup[1]

# Select the 1st value from ended_at
data_2022_v001$ended_at_dup[1]

# get the ride_time 
data_2022_v001$ended_at_dup[1]-data_2022_v001$started_at_dup[1]
```
*  By subtracting the 1st value of "started_at" from "ended_at", I am getting the value of "ride_time" in the time format, which is as per my requirement.

# __5) Shape the dataframe__

A ride time start can't be greater than a ride time end, nor equal. Let us verify the latter.

```{r}
sum(data_2022_v001$started_at_dup>=data_2022_v001$ended_at_dup)
```

* We have 531 records that confirms the above.
* It means that the date time they started the ride is > date time ended the ride, this can't be possible.
* It might be an error during "Data collection".

```{r}
# get the Subset of the data frame after excluding the values where "started_at_dup" >= "endend_at_dup"

data_2022_v002 <- data_2022_v001[data_2022_v001$started_at_dup<data_2022_v001$ended_at_dup,]

# validate the results by re-checking the count of rows

str(data_2022_v002)
```
* We have total 5,667,186 rows which means 531 rows are successfully excluded.

```{r}
# calculate the ride time

data_2022_v002$ride_time <- ((data_2022_v002$ended_at_dup)-(data_2022_v002$started_at_dup))/60

str(data_2022_v002)

```
* The resulted ride_time is given in the 'Seconds' so we have converted it into 'Minutes' by dividing it by 60.

# __6) Check for the Null Values__

```{r}
colSums(is.na(data_2022_v002))
```
* The quantitative column name "end_lat" and "end_lng" have null values.
* No Null values found in started_at, ended_at, member_casual and ride_d, ride_time. This is good because it helps
to examine each ride.

# __7) Check for misspellings__

* For the qualitative columns "rideable_type" and "member_casual" I have check for the possible typo errors.
* Example:   
      + casual, casualll, caslaul   
      + Electric bike, electrik_bike, clasic_bike   

```{r}
# To know the unique values from 'rideable_type'
unique(data_2022_v002$rideable_type)
```
```{r}
# To know the unique values from 'member_casual'
unique(data_2022_v002$member_casual)
```

* No misspellings found

# __8) Check for duplicates__

* Each ride is unique & I hope to have unique records (rows).
* The dataset, has the ride_id column which describes each ride taken by a casual or an annual member.

```{r}
sum(duplicated(data_2022_v002$ride_id))
```
* Zero value returned, hence there are no duplicates for the column "ride_id". This confirms that each record
of the dataframe is unique.


# __9) Add a new Columns "Weekday" & "Month"__

* I do this to have a data in shape for the __Analyse__ step of data analysis process.

```{r}
# add the name of the day from started_at
data_2022_v002$weekday <- wday(data_2022_v002$started_at_dup,week_start=1,label = TRUE)

# add the name of the month from started_at
data_2022_v002$month <- month(data_2022_v002$started_at_dup,label = TRUE)

str(data_2022_v002)
```
\newpage
# __IV) Analyse__

* In this step of the data analysis process, I will do calculations, data shaping to sketch visuals for the Share step.   

# __1) Number of yearly rides for each type of customer__

```{r}
# Use pipes '%>%' to drill down the data 
library(tidyverse)
data_2022_v002 %>% 
  group_by(member_casual) %>% 
  summarise(count=n()) %>% 
  rename("total"="count")

```

```{r}
# Plot an bar_chart to compare the number of rides visually

library(ggplot2)
ggplot(data = data_2022_v002)+
  geom_bar(mapping = aes(x=member_casual,fill=member_casual),show.legend = FALSE,width = 0.8)+
  labs(y="total",title = "Total number of rides for the year 2022")
  
```
\newpage
```{r}
#Create a data frame of member_casual_count_summary
member_casual_summary<- data_2022_v002 %>% 
                              group_by(member_casual) %>% 
                              summarise(count=n())

#Create a labels for pie chart
pie_labels <- paste0(round(100*member_casual_summary$count/sum(member_casual_summary$count),2),"%")

pie(member_casual_summary$count,labels = pie_labels,lty = 2, main = "% of ride by customer type")

```
\newpage
# __2) Total rides taken per month for each type of customers__  


```{r warning=FALSE}
# Select the required columns & reshape the data
monthly_ride_count <- data_2022_v002 %>% 
                      group_by(month,member_casual) %>% 
                      summarise(count_of_ride =n())

# Plot the line chart 
ggplot(monthly_ride_count,aes(x=month,y=count_of_ride,group=member_casual,xlim(0,400000)))+
  geom_point(aes(color=member_casual),size=1.5)+
  geom_line(aes(color=member_casual),size=1)+
  labs(x="Month",y="Count_of_rides",title = "Total No. of rides per month")

```
\newpage
## Monthly ride count difference between member and casual riders

```{r}
# Created an subset of data frame
monthly_ride_count_2 <- monthly_ride_count %>% 
                        pivot_wider(names_from = member_casual,values_from = count_of_ride) %>% #use pivot_wider to convert rows into columns
                        mutate(ride_count_diff = member-casual)
print(monthly_ride_count_2)

```
## Average of monthly ride count difference between member and casual riders

```{r}
mean(monthly_ride_count_2$ride_count_diff)

```
\newpage
# __3) Total rides taken each day in a week for each type of customers__

```{r}
day_wise_ride_count <- data_2022_v002 %>% 
                      group_by(weekday,member_casual) %>% 
                      summarise(count_of_ride =n()) %>% 
                      pivot_wider(names_from = member_casual,values_from = count_of_ride) %>% 
                      mutate(total_rides = casual+member) %>% 
                      mutate(casual_percentage= (casual/total_rides)*100) %>% 
                      mutate(member_percentage= (member/total_rides)*100)
print(day_wise_ride_count)
```

\newpage
```{r}
day_wise_ride_count_2 <- data_2022_v002 %>% 
                      group_by(weekday,member_casual) %>% 
                      summarise(count_of_ride =n())
ggplot(data = day_wise_ride_count_2)+
  geom_col(mapping=aes(x=weekday,y=count_of_ride,fill=member_casual))+
  labs(x="day_of_week",y="Count_of_rides",title = "Day wise total ride count")

```
\newpage
# __4) Types of bikes per type of customers__

```{r}
bike_type_count <- data_2022_v002 %>% 
                   group_by(rideable_type) %>% 
                   summarise(ride_count=n()) %>% 
                   mutate(ride_count_percentage = round(100*ride_count/sum(ride_count),1))
print(bike_type_count)


```

```{r}
  
pie(bike_type_count$ride_count,labels = paste0(bike_type_count$ride_count_percentage,"%"),col = rainbow(length(bike_type_count$ride_count)))
legend("topright",bike_type_count$rideable_type,cex = 0.8,fill = rainbow(length(bike_type_count$ride_count)))

```
\newpage
```{r}
bike_type_count_2 <- data_2022_v002 %>% 
                   group_by(rideable_type,member_casual) %>%
                   summarise(ride_count=n()) %>% 
                   pivot_wider(names_from = member_casual,values_from = ride_count) %>% 
                   mutate(total_ride_count = sum(casual,member,na.rm=TRUE)) %>% 
                   mutate(casual_percentage = round(100*(casual/total_ride_count),2)) %>% 
                   mutate(member_percentage = round(100*(member/total_ride_count),2))
print(bike_type_count_2)
```


```{r warning=FALSE}
bike_type_count_3 <- data_2022_v002 %>% 
                   group_by(rideable_type,member_casual) %>%
                   summarise(ride_count=n())
ggplot(data = bike_type_count_3)+
  geom_col(mapping=aes(x=rideable_type,y=ride_count,fill=member_casual))+
  labs(x="rideable_type",y="total_rides",title = "Total number of rides/rideable type")

```
\newpage
# __V) Share & Act__

* I will skip the following steps __Share__ and __Act__ because, the analysis is a personal project.
* I will go directly to findings and recommendations.   

# __VI) Findings and Recommendations__  

## __1) How do annual members and casual riders use Cyclistic bikes differently?__

* For the year __2022__, which is our study time, we have more rides for annual members ( __59%__ rides) than casual riders ( __41%__).
* When we go down to a finer level, at a month, we observe the following between the casual & annual members:
  + The difference in ride is of an average of __85,304__ rides
  + For the months of __June__ and __July__ the total number of rides are fairly close as compared to the other months.  
* At the week day level of granularity, for the days: __Saturday__ and __Sunday__, casual riders have greater rides than annual members.
* Docked bikes are only used by casual riders, it represents __3%__ of rides (electric 51% and classic 46%).
* 34.3% of rides by classic bikes are casual riders and 65.7% are annual members.
* 43.4% of rides by electric bikes are casual riders and 56.6% are annual members.   

## __2)  Why would casual riders buy Cyclistic annual memberships?__  

* We previously saw that casual riders ride more on weekends, if they have to ride at the same pace during the weekdays, it may motivate them to become annual members.
* If their preference for docked bikes shift to classic or electric bikes, Cyclistic can hope of having an increase in annual members.
* To understand more about the customer's choice of becoming annual members or casual riders and their ride time, the following information can help to do a finer analysis:
  + The reason behind each rides, example: home, work, leisure..
  + The cost details for rider type and bike type

## __3) How can Cyclistic use digital media to influence casual riders to become members?__

Through influencer marketing, advertising and environmental awareness campaign on social media and TV,Cyclistic can work on the following:  

* The advantages of using more electric bikes (environmentally friendly) than docked bikes (from our sample data, we do not have annual members for docked bikes only for electric & classic bikes).
* Encourage casual riders to ride throughout the week as they do during the weekend.
* The advantages in becoming an annual member, example: it can be less costly when we compare the average price (in a year, month, week, day) for each ride as an annual member as compared to a casual rider.


































